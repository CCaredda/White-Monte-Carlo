<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Process White Monte Carlo Image Reconstruction: Process White Monte Carlo Image Reconstruction</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Process White Monte Carlo Image Reconstruction
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Process White Monte Carlo Image Reconstruction </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="intro_sec"></a>
Introduction</h1>
<p>This software allows the propagation of light within brain tissue and the modeling of the acquisition of retro-diffused light.</p>
<p>This software is a digital phantom that can be used as an instrument simulator (DIS). The main objective of this simulator is to develop a computational tool able to simulate brain tissue optical parameters and incorporate realistic instrument specifications, in order to (i) assist the development of the hyperspectral imaging prototypes, and (ii) generate synthetic data to help the development of the machine learning algorithm.</p>
<p>This software has been developed for the European project Hyperprobe which aims at transforming neuronavigation during glioma resection using novel hyperspectral imaging technology:</p><ul>
<li><a href="https://hyperprobe.eu/">https://hyperprobe.eu/</a></li>
<li><a href="https://cordis.europa.eu/project/id/101071040">https://cordis.europa.eu/project/id/101071040</a></li>
</ul>
<p>Author: Charly Caredda Contact: <a href="#" onclick="location.href='mai'+'lto:'+'car'+'ed'+'da.'+'c@'+'gma'+'il'+'.co'+'m'; return false;">cared<span class="obfuscator">.nosp@m.</span>da.c<span class="obfuscator">.nosp@m.</span>@gmai<span class="obfuscator">.nosp@m.</span>l.co<span class="obfuscator">.nosp@m.</span>m</a></p>
<h1><a class="anchor" id="install_sec"></a>
Installation</h1>
<p>This program has be tested under Fedora 38 and Ubuntu. Problem may occur under other operating system. This program is coded in Python and Matlab. Matlab and Python need to be installed.</p>
<p>The matlab software MCXLab need to be downloaded: <a href="https://mcx.space/wiki/?Get">https://mcx.space/wiki/?Get</a> Please download the latest version.</p>
<p>For Python, several libraries need to be installed:</p>
<ul>
<li>sudo dnf install python3-pip python3-pyqt5</li>
<li>pip install opencv-python numpy matplotlib</li>
</ul>
<h1><a class="anchor" id="sec_guide"></a>
User guide</h1>
<p>The software is separated in two parts:</p><ul>
<li>Image segmentation</li>
<li>White Monte Carlo simulations</li>
</ul>
<h2><a class="anchor" id="img_seg"></a>
1) Image segmentation</h2>
<p>To simulate the light propagation within the brain tissue, a model of brain tissue needs to be created. A real RGB image of brain exposed cortex is taken as the input. This image is then segmented into six classes using the python script: "manual_segmentation.py":</p><ul>
<li>Non activated grey matter</li>
<li>Non activated large blood vessels</li>
<li>Non activated capillaries</li>
<li>Activated grey matter</li>
<li>Activated large blood vessels</li>
<li>Activated capillaries</li>
</ul>
<p>The results of this segmentation step are written in the folder "images/Patientx". A folder Patientx needs to created prior to the execution of the python script. It must contains:</p><ul>
<li>the input image "initial_img.png"</li>
<li>the mask of the surgical window "mask.png"</li>
<li>if you want to model activated areas, a mask need to be created. For this copy the input image "initial_img.png" into "mask_activity.png" and color the activated area in black.</li>
</ul>
<p>Some variables in the script need to be changed (data path and other variables)</p>
<h2><a class="anchor" id="sec_simu"></a>
2) Simulations</h2>
<p>In the folder "run_simulations" several scripts can be used to process white Monte Carlo simulations:</p>
<p>a) "run_simulations.m" This script is used to compute White Monte Carlo simulations. This script can be executed on a cluster. For this purpose, the bash script "run_simulations.sh" need to be used.</p>
<p>The input that need to be indicated in the matlab script are:</p>
<ul>
<li>The resolution of the volume in mm (parameter model_resolution_in_mm). If 0, the resolution is the same as the input image.</li>
<li>Wavelength to be simulated, array or scalar (parameter Lambdas)</li>
<li>Parameter run_in_cluster, set 0 to process locally and set 1 to use a cluster</li>
<li>Number of Monte Carlo repetitions. Used to increase the SNR (parameter nb_repeat)</li>
<li>Number of packets of photons launched on the tissue (parameter nb_photons)</li>
<li>Path for outputs (parameter out_path)</li>
<li>Input image path that contain images creates at step 1) (parameter in_img_path)</li>
</ul>
<p>The outputs are:</p><ul>
<li>zip file for each simulated wavelength. A zip file contain 4 txt files (partial path length, position of exiting photons, angle of exiting photons, tissue optical properties at the considered wavelength).</li>
<li>mat and txt file that contain simulation information</li>
</ul>
<p>b) "process_Hypercubes.m"</p>
<p>This script can be used to reconstruct hypercubes (diffuse reflectance and mean path length images) after the execution of script a) "run_simulations.m" !!!! Caution !!!! This script can only be executed when using a small number of photons. Otherwise please use the C++ software.</p>
<p>c) "run_simu_and_process_Hypercubes.m"</p>
<p>This script can be used to simulate light propagation in tissue and reconstruct hypercubes (diffuse reflectance and mean path length images). !!!! Caution !!!! This script can only be executed when using a small number of photons. Otherwise please use the C++ software. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6
</small></address>
</body>
</html>
